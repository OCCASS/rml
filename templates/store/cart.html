{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/cart.css' %}" />
{% endblock %}

{% block content %}
  <section class="cart">
    {% if cart.items %}
      <div class="cart__items">
        {% for item in cart.items %}
          {% with image=item.product.main_image %}
            <article
              class="cart__item"
              data-item
              data-product-id="{{ item.product.id }}"
              data-add-url="{% url 'store:add_to_cart' item.product.slug %}"
              data-remove-url="{% url 'store:remove_from_cart' item.product.slug %}"
            >
              {% if image %}
                <img class="cart__item-image" src="{% static image.image_path %}" alt="{{ image.alt_text|default:item.product.name }}" />
              {% else %}
                <img class="cart__item-image" src="{% static 'images/main1.jpg' %}" alt="{{ item.product.name }}" />
              {% endif %}
              <div class="cart__item-info">
                <div class="cart__item-header">
                  <a class="cart__item-title" href="{{ item.product.get_absolute_url }}">{{ item.product.name }}</a>
                </div>
                <p class="cart__item-price">{{ item.product.price|floatformat:0 }}₽</p>
                <div class="cart__item-controls">
                  <div class="cart__quantity">
                    <span class="cart__quantity-title">Количество</span>
                    <div class="cart__quantity-controls" role="group" aria-label="Количество для {{ item.product.name }}">
                      <button type="button" class="cart__quantity-btn" data-quantity-action="decrease" aria-label="Уменьшить количество">
                        -
                      </button>
                      <span class="cart__quantity-value" data-quantity>{{ item.quantity }}</span>
                      <button type="button" class="cart__quantity-btn" data-quantity-action="increase" aria-label="Увеличить количество">
                        +
                      </button>
                    </div>
                  </div>
                  <div class="cart__item-total" data-item-total>{{ item.total_price|floatformat:0 }}₽</div>
                </div>
              </div>
            </article>
          {% endwith %}
        {% endfor %}
      </div>
      <div class="cart__summary">
        <div class="cart__summary-line">
          <span>Итого</span>
          <strong data-cart-total>{{ cart.total_amount|floatformat:0 }}₽</strong>
        </div>
        <form method="post" action="{% url 'store:checkout' %}">
          {% csrf_token %}
          <button type="submit" class="cart__checkout">Перейти к оплате</button>
        </form>
      </div>
    {% else %}
      <p class="cart__empty">Корзина пока пуста.</p>
    {% endif %}
  </section>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/cart.js' %}"></script>
{% endblock %}
